{% load static %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

<script>
document.addEventListener("DOMContentLoaded", function () {
  const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]')?.value;

  // âœ… Ø¨Ø®Ø´ Û± â€” Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ AJAX (Contact / Newsletter)
  const allForms = document.querySelectorAll("form");

  allForms.forEach((form) => {
    form.addEventListener("submit", function (e) {
      const isAjax = form.hasAttribute("data-ajax");
      if (!isAjax) return;

      e.preventDefault();

      const formData = new FormData(form);
      const action = form.getAttribute("action") || window.location.href;

      fetch(action, {
        method: "POST",
        body: formData,
        headers: {
          "X-Requested-With": "XMLHttpRequest",
          "X-CSRFToken": csrftoken || "",
        },
      })
        .then((res) => res.json())
        .then((data) => {
          Swal.fire({
            icon: data.success ? "success" : "error",
            title: data.message || (data.success ? "Success!" : "Error!"),
            confirmButtonColor: "#052b26",  // ðŸ‘ˆ Ø±Ù†Ú¯ Ø¯Ú©Ù…Ù‡ OK
            background: "#fff",
            color: "#333",
            width: "30em",
            showClass: { popup: "animate__animated animate__fadeInDown" },
            hideClass: { popup: "animate__animated animate__fadeOutUp" },
          });
          if (data.success) form.reset();
        })
        .catch(() => {
          Swal.fire({
            icon: "error",
            title: "Server Error",
            text: "Something went wrong, please try again later.",
            confirmButtonColor: "#052b26",  // ðŸ‘ˆ Ù‡Ù…ÛŒÙ†â€ŒØ¬Ø§ Ù‡Ù…
          });
        });
    });
  });
});
</script>

<!-- âœ… Ø¨Ø®Ø´ Û² â€” Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Django (Redirect Ù…Ø«Ù„ Login/Signup) -->
{% if messages %}
<script>
document.addEventListener("DOMContentLoaded", function() {
  {% for message in messages %}
    Swal.fire({
      icon: "{{ message.tags }}".includes("success") ? "success" : "error",
      title: "{{ message|escapejs }}",
      confirmButtonColor: "#052b26",  // ðŸ‘ˆ Ø±Ù†Ú¯ Ø«Ø§Ø¨Øª Ø¯Ú©Ù…Ù‡ OK
      background: "#fff",
      color: "#333",
      width: "30em",
      showClass: { popup: "animate__animated animate__fadeInDown" },
      hideClass: { popup: "animate__animated animate__fadeOutUp" },
    });
  {% endfor %}
});
</script>
{% endif %}
